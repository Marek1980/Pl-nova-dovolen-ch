<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pl√°novaƒç - DEBUG VERZE</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        input { padding: 8px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .debug-box { background: #fff3cd; border: 4px solid #ffc107; color: #856404; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // -----------------------------------------------------------
        // 1. ZDE NASTAV SVOJE √öDAJE (BEZ TOHO TO NEPUJDE)
        // -----------------------------------------------------------
        const SUPABASE_URL = 'https://bprawiumolizfnhuigpf.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_OCC-K3xibSWzFoLgcQ7kyg_39EH34zQ';
        const ADMIN_EMAIL = 'marek.horacek@alza.cz'; 
        // -----------------------------------------------------------

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function App() {
            const [session, setSession] = React.useState(null);
            const [requests, setRequests] = React.useState([]);
            const [form, setForm] = React.useState({ email: '', pass: '', from: '', to: '' });
            const [isAdmin, setIsAdmin] = React.useState(false);

            React.useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setSession(session);
                    if (session) checkUser(session);
                });

                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setSession(session);
                    if (session) checkUser(session);
                });
                return () => subscription.unsubscribe();
            }, []);

            const checkUser = (s) => {
                const userEmail = s.user.email.toLowerCase().trim();
                const adminEmail = ADMIN_EMAIL.toLowerCase().trim();
                setIsAdmin(userEmail === adminEmail);
                fetchRequests();
            };

            const fetchRequests = async () => {
                const { data } = await supabase.from('leave_requests').select('*, profiles(full_name)').order('created_at', { ascending: false });
                setRequests(data || []);
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                const { error } = await supabase.auth.signInWithPassword({ email: form.email, password: form.pass });
                if (error) await supabase.auth.signUp({ email: form.email, password: form.pass });
            };

            const handleStatus = async (id, status) => {
                await supabase.from('leave_requests').update({ status }).eq('id', id);
                fetchRequests();
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const { data: { user } } = await supabase.auth.getUser();
                await supabase.from('profiles').upsert({ id: user.id, full_name: user.email.split('@')[0] });
                await supabase.from('leave_requests').insert([{ user_id: user.id, date_from: form.from, date_to: form.to }]);
                fetchRequests();
                alert("Odesl√°no!");
            };

            // TOTO JE TO HLAVN√ç - V≈ΩDY VIDITELN√ù PANEL
            return (
                <div>
                    <div className="debug-box">
                        <h2 style={{marginTop:0}}>üïµÔ∏è DETEKTIVN√ç PANEL (Verze 6.0)</h2>
                        <p><strong>Tv≈Øj stav:</strong> {session ? 'üü¢ P≈ôihl√°≈°en' : 'üî¥ Odhl√°≈°en'}</p>
                        <p><strong>Tv≈Øj email:</strong> {session ? session.user.email : '---'}</p>
                        <p><strong>Admin email v k√≥du:</strong> {ADMIN_EMAIL}</p>
                        <hr style={{borderColor:'#ffeeba'}}/>
                        <p style={{fontSize:'1.2em'}}>
                            <strong>JSI ADMIN? üëâ </strong> 
                            {isAdmin ? <span style={{color:'green', fontWeight:'bold'}}>ANO ‚úÖ</span> : <span style={{color:'red', fontWeight:'bold'}}>NE ‚ùå</span>}
                        </p>
                        {!isAdmin && session && <p><em>(Proto≈æe se tv≈Øj email neshoduje s t√≠m v k√≥du)</em></p>}
                    </div>

                    {!session ? (
                        <div className="card" style={{maxWidth: 300, margin: '0 auto', textAlign: 'center'}}>
                            <h2>üîê P≈ôihl√°≈°en√≠</h2>
                            <form onSubmit={handleLogin}>
                                <input type="email" placeholder="Email" onChange={e => setForm({...form, email:e.target.value})} />
                                <input type="password" placeholder="Heslo" onChange={e => setForm({...form, pass:e.target.value})} />
                                <button>Vstoupit / Registrovat</button>
                            </form>
                        </div>
                    ) : (
                        <div>
                            <div style={{display:'flex', justifyContent:'space-between'}}>
                                <h3>Aplikace bƒõ≈æ√≠</h3>
                                <button onClick={() => supabase.auth.signOut()} style={{background:'#666'}}>Odhl√°sit se</button>
                            </div>

                            {isAdmin ? (
                                <div className="card" style={{borderLeft: '5px solid green'}}>
                                    <h2 style={{color:'green', marginTop:0}}>üëë V√çTEJ ≈†√âFE (ADMIN PANEL)</h2>
                                    <p>Zde m≈Ø≈æe≈° schvalovat dovolen√©:</p>
                                    {requests.map(r => (
                                        <div key={r.id} style={{padding: 10, borderBottom: '1px solid #eee', display:'flex', justifyContent:'space-between'}}>
                                            <span>{r.profiles?.full_name} ({r.date_from} - {r.date_to})</span>
                                            <div>
                                                <button onClick={() => handleStatus(r.id, 'approved')} style={{background:'green', marginRight:5}}>‚úÖ</button>
                                                <button onClick={() => handleStatus(r.id, 'rejected')} style={{background:'red'}}>‚ùå</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="card">
                                    <h3>‚ûï ≈Ω√°dost o dovolenou</h3>
                                    <form onSubmit={handleSubmit}>
                                        <input type="date" onChange={e => setForm({...form, from:e.target.value})} />
                                        <input type="date" onChange={e => setForm({...form, to:e.target.value})} />
                                        <button>Odeslat</button>
                                    </form>
                                    <h4>Moje ≈æ√°dosti:</h4>
                                    <ul>
                                        {requests.filter(r => r.user_id === session.user.id).map(r => (
                                            <li key={r.id}>{r.date_from} - {r.status}</li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

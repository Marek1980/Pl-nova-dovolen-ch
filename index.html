<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alza Pl√°novaƒç - Full Verze</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; margin: 0; padding: 20px; color: #1e293b; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        h2, h3 { margin-top: 0; color: #0f172a; }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; background: white; }
        button { width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        button:hover { background: #2563eb; transform: translateY(-1px); }
        .btn-secondary { background: #64748b; width: auto; padding: 8px 16px; font-size: 0.9em; }
        .btn-delete { background: #ef4444; width: auto; padding: 4px 10px; font-size: 0.8em; margin-left: 5px; }
        .btn-approve { background: #22c55e; width: auto; margin-right: 5px; }
        .btn-reject { background: #ef4444; width: auto; }
        .btn-nav { background: white; color: #3b82f6; border: 2px solid #3b82f6; width: auto; padding: 5px 15px; margin-left: 5px; }
        .btn-nav.active { background: #3b82f6; color: white; }
        
        /* Tlaƒç√≠tko pro ulo≈æen√≠ (disketa) */
        .btn-save-limit { background: #10b981; padding: 8px; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 6px; }
        .btn-save-limit:hover { background: #059669; }

        .row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f5f9; }
        .user-tag { background: #e0f2fe; color: #0369a1; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
        
        /* Kalend√°≈ô styly */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; position: relative; z-index: 2; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; position: relative; z-index: 2; }
        .day-header { text-align: center; font-weight: bold; color: #64748b; font-size: 0.8em; text-transform: uppercase; padding-bottom: 5px; text-shadow: 0 0 2px white; }
        .day { padding: 5px; background: rgba(255, 255, 255, 0.9); border: 1px solid #e2e8f0; border-radius: 6px; min-height: 70px; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        .leave-vacation { background: #3b82f6; color: white; border-color: #2563eb; }
        .leave-half { background: #06b6d4; color: white; border-color: #0891b2; }
        .leave-whatever { background: #d946ef; color: white; border-color: #c026d3; }
        .day.weekend { background: rgba(255, 247, 237, 0.9); border-color: #ffedd5; }
        .day.weekend .day-number { color: #c2410c; }
        .day.holiday { background: rgba(243, 232, 255, 0.9); border-color: #d8b4fe; }
        .day.holiday .holiday-name { color: #7e22ce; font-weight: bold; }
        .day.busy { background: rgba(240, 249, 255, 0.95); border-color: #bae6fd; }
        .day-number { font-weight: bold; font-size: 1.1em; margin-bottom: 2px; }
        .holiday-name { font-size: 0.65em; line-height: 1.1; margin-bottom: 2px; }
        .leave-badge { font-size: 0.7em; padding: 2px 4px; border-radius: 3px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; margin-top: 1px; color: white; }

        .month-card { position: relative; background: #ffffff; border-radius: 12px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e2e8f0; }
        .month-bg-image { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-size: cover; background-position: center; opacity: 0.25; z-index: 0; pointer-events: none; filter: grayscale(20%); transition: background-image 0.5s ease-in-out; }

        .year-grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .year-grid-layout { grid-template-columns: 1fr; } }
        
        .bday-table { width: 100%; border-collapse: collapse; }
        .bday-table th { text-align: left; color: #64748b; font-size: 0.9em; padding: 10px; border-bottom: 2px solid #f1f5f9; }
        .bday-table td { padding: 12px 10px; border-bottom: 1px solid #f1f5f9; }
        .age-tag { background: #fce7f3; color: #db2777; padding: 4px 8px; border-radius: 20px; font-weight: bold; font-size: 0.9em; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // --------------------------------------------------------
        // ‚ùó‚ùó KONFIGURACE ‚ùó‚ùó
        // --------------------------------------------------------
        const SUPABASE_URL = 'https://bprawiumolizfnhuigpf.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_OCC-K3xibSWzFoLgcQ7kyg_39EH34zQ';
        const ADMIN_EMAIL = 'marek.horacek@alza.cz'; 
        const DEFAULT_PASS = 'alza-tajne-heslo-2026'; 
        // --------------------------------------------------------

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const MONTH_THEMES = [
            "https://images.unsplash.com/photo-1477601263568-180e2c6d046e?w=800&q=80",
            "https://plus.unsplash.com/premium_photo-1670347626594-d60b7c3e2ba5?w=800&q=80",
            "https://images.unsplash.com/photo-1462275646964-a0e3386b89fa?w=800&q=80",
            "https://images.unsplash.com/photo-1522748906645-95d8adfd52c7?w=800&q=80",
            "https://images.unsplash.com/photo-1506152983158-b4a74a01c721?w=800&q=80",
            "https://plus.unsplash.com/premium_photo-1670574872504-56cdb36ffa64?w=800&q=80",
            "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800&q=80",
            "https://images.unsplash.com/photo-1470240731273-7821a6eeb6bd?w=800&q=80",
            "https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=800&q=80",
            "https://images.unsplash.com/photo-1509023464722-18d996393ca8?w=800&q=80",
            "https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=800&q=80",
            "https://images.unsplash.com/photo-1543589077-47d81606c1bf?w=800&q=80"
        ];

        const getTypeName = (type) => {
            if (type === 'half') return 'üåì P≈Øl den';
            if (type === 'whatever') return 'ü¶Ñ Whatever';
            return 'üå¥ Dovolen√°';
        };

        const getCzechHoliday = (day, month, year) => {
            const fixed = { '1-1': 'Nov√Ω rok', '1-5': 'Sv√°tek pr√°ce', '8-5': 'Den v√≠tƒõzstv√≠', '5-7': 'Cyril a Metodƒõj', '6-7': 'Jan Hus', '28-9': 'Sv. V√°clav', '28-10': 'Vznik ƒåSR', '17-11': 'Den boje za svobodu', '24-12': '≈†tƒõdr√Ω den', '25-12': '1. sv√°tek v√°noƒçn√≠', '26-12': '2. sv√°tek v√°noƒçn√≠' };
            const key = `${day}-${month}`;
            if (fixed[key]) return fixed[key];
            const a = year % 19, b = Math.floor(year / 100), c = year % 100, d = Math.floor(b / 4), e = b % 4, f = Math.floor((b + 8) / 25), g = Math.floor((b - f + 1) / 3), h = (19 * a + b - d - g + 15) % 30, i = Math.floor(c / 4), k = c % 4, l = (32 + 2 * e + 2 * i - h - k) % 7, m = Math.floor((a + 11 * h + 22 * l) / 451), easterMonth = Math.floor((h + l - 7 * m + 114) / 31), easterDay = ((h + l - 7 * m + 114) % 31) + 1;
            const easterDate = new Date(year, easterMonth - 1, easterDay);
            const goodFriday = new Date(easterDate); goodFriday.setDate(easterDate.getDate() - 2);
            const easterMonday = new Date(easterDate); easterMonday.setDate(easterDate.getDate() + 1);
            const check = new Date(year, month - 1, day);
            if (check.getTime() === goodFriday.getTime()) return 'Velk√Ω p√°tek';
            if (check.getTime() === easterMonday.getTime()) return 'Velikonoce';
            return null;
        };

        const calculateWorkDays = (startStr, endStr) => {
            if (!startStr || !endStr) return 0;
            let count = 0;
            let current = new Date(startStr);
            const end = new Date(endStr);
            while (current <= end) {
                const day = current.getDate();
                const month = current.getMonth() + 1;
                const year = current.getFullYear();
                const dayOfWeek = current.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const isHoliday = getCzechHoliday(day, month, year) !== null;
                if (!isWeekend && !isHoliday) count++;
                current.setDate(current.getDate() + 1);
            }
            return count;
        };

        const calculateAge = (dateString) => {
            if (!dateString) return null;
            const birth = new Date(dateString);
            const now = new Date();
            const diff = now - birth;
            const age = diff / (1000 * 60 * 60 * 24 * 365.25);
            return age.toFixed(1);
        };

        function SingleMonthView({ monthIndex, year, requests }) {
            const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
            const firstDayIndex = new Date(year, monthIndex, 1).getDay();
            const offsetDays = firstDayIndex === 0 ? 6 : firstDayIndex - 1;
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            const emptySlots = Array.from({ length: offsetDays }, (_, i) => i);
            const weekDays = ['Po', '√öt', 'St', 'ƒåt', 'P√°', 'So', 'Ne'];
            const monthName = new Date(year, monthIndex, 1).toLocaleString('cs-CZ', { month: 'long' });

            const getBusy = (day) => {
                const dateStr = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                return requests.filter(r => r.status === 'approved' && r.date_from <= dateStr && r.date_to >= dateStr);
            };

            return (
                <div className="month-card" style={{marginBottom:0}}>
                    <div className="month-bg-image" style={{ backgroundImage: `url(${MONTH_THEMES[monthIndex]})` }}></div>
                    <div className="calendar-header" style={{justifyContent:'center'}}>
                        <h3 style={{margin:0, textTransform:'capitalize', fontSize:'1.3em', textShadow:'0 0 10px white'}}>{monthName}</h3>
                    </div>
                    <div className="calendar-grid">
                        {weekDays.map(d => <div key={d} className="day-header" style={{fontSize:'0.7em'}}>{d}</div>)}
                        {emptySlots.map(s => <div key={`empty-${s}`}></div>)}
                        {days.map(d => {
                            const dateObj = new Date(year, monthIndex, d);
                            const dayOfWeek = dateObj.getDay();
                            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                            const holidayName = getCzechHoliday(d, monthIndex + 1, year);
                            const busyList = getBusy(d);
                            let className = 'day';
                            if (holidayName) className += ' holiday';
                            else if (isWeekend) className += ' weekend';
                            if (busyList.length > 0) className += ' busy';
                            return (
                                <div key={d} className={className} style={{minHeight: 50}}>
                                    <div><div className="day-number" style={{fontSize:'0.9em'}}>{d}</div></div>
                                    <div style={{display:'flex', flexDirection:'column', gap:1}}>
                                        {busyList.map(r => (
                                            <div key={r.id} className={`leave-badge leave-${r.type || 'vacation'}`} title={r.profiles?.full_name}>
                                                {r.profiles?.full_name.split(' ')[0]}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        function YearView({ requests }) {
            const months = Array.from({ length: 12 }, (_, i) => i);
            return (
                <div className="year-grid-layout">
                    {months.map(m => (
                        <SingleMonthView key={m} monthIndex={m} year={2026} requests={requests} />
                    ))}
                </div>
            );
        }

        function DashboardCalendar({ requests }) {
            const [viewDate, setViewDate] = React.useState(new Date());
            const changeMonth = (offset) => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + offset, 1));
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayIndex = new Date(year, month, 1).getDay();
            const offsetDays = firstDayIndex === 0 ? 6 : firstDayIndex - 1;
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            const emptySlots = Array.from({ length: offsetDays }, (_, i) => i);
            const weekDays = ['Po', '√öt', 'St', 'ƒåt', 'P√°', 'So', 'Ne'];
            const monthName = viewDate.toLocaleString('cs-CZ', { month: 'long', year: 'numeric' });
            
            const getBusy = (day) => {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                return requests.filter(r => r.status === 'approved' && r.date_from <= dateStr && r.date_to >= dateStr);
            };

            return (
                <div className="month-card">
                    <div className="month-bg-image" style={{ backgroundImage: `url(${MONTH_THEMES[month]})` }}></div>
                    <div className="calendar-header">
                        <button className="btn-nav" onClick={() => changeMonth(-1)}>‚¨ÖÔ∏è</button>
                        <h3 style={{margin:0, textTransform:'capitalize', fontSize:'1.5em', textShadow:'0 0 10px white'}}>{monthName}</h3>
                        <button className="btn-nav" onClick={() => changeMonth(1)}>‚û°Ô∏è</button>
                    </div>
                    <div className="calendar-grid">
                        {weekDays.map(d => <div key={d} className="day-header">{d}</div>)}
                        {emptySlots.map(s => <div key={`empty-${s}`}></div>)}
                        {days.map(d => {
                            const dateObj = new Date(year, month, d);
                            const dayOfWeek = dateObj.getDay();
                            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                            const holidayName = getCzechHoliday(d, month + 1, year);
                            const busyList = getBusy(d);
                            let className = 'day';
                            if (holidayName) className += ' holiday';
                            else if (isWeekend) className += ' weekend';
                            if (busyList.length > 0) className += ' busy';
                            return (
                                <div key={d} className={className}>
                                    <div>
                                        <div className="day-number">{d}</div>
                                        {holidayName && <div className="holiday-name">{holidayName}</div>}
                                    </div>
                                    <div style={{display:'flex', flexDirection:'column', gap:2}}>
                                        {busyList.map(r => (
                                            <div key={r.id} className={`leave-badge leave-${r.type || 'vacation'}`} title={getTypeName(r.type)}>
                                                {r.profiles?.full_name.split(' ')[0]}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        function WhoIsMissing({ requests }) {
            const today = new Date().toISOString().split('T')[0];
            const missing = requests.filter(r => r.status === 'approved' && r.date_from <= today && r.date_to >= today);
            if (missing.length === 0) return null;
            return (
                <div className="card" style={{borderLeft: '5px solid #ef4444', background: '#fff5f5'}}>
                    <h3 style={{marginBottom: 10, color: '#b91c1c'}}>üö´ Dnes ({new Date().toLocaleDateString('cs-CZ')}) chyb√≠:</h3>
                    <div style={{display:'flex', gap: 10, flexWrap:'wrap'}}>
                        {missing.map(r => (
                            <div key={r.id} style={{background:'white', padding:'5px 10px', borderRadius:20, border:'1px solid #fecaca', display:'flex', alignItems:'center', gap:5}}>
                                <strong>{r.profiles?.full_name}</strong><span style={{fontSize:'0.8em', color:'#666'}}>{r.type === 'whatever' ? 'ü¶Ñ Sick/HO' : 'üå¥ Dovolen√°'}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function App() {
            const [session, setSession] = React.useState(null);
            const [requests, setRequests] = React.useState([]);
            const [allowedEmails, setAllowedEmails] = React.useState([]);
            const [myProfile, setMyProfile] = React.useState(null);
            const [allProfiles, setAllProfiles] = React.useState([]);
            const [view, setView] = React.useState('dashboard');
            const [form, setForm] = React.useState({ email: '', from: '', to: '', type: 'vacation', newUser: '', bdayName: '', bdayDate: '' });
            const [isAdmin, setIsAdmin] = React.useState(false);
            const [loading, setLoading] = React.useState(false);
            const [workDaysCost, setWorkDaysCost] = React.useState(0);
            
            React.useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => { setSession(session); if (session) initData(session); });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => { setSession(session); if (session) initData(session); });
                return () => subscription.unsubscribe();
            }, []);

            React.useEffect(() => {
                if (form.from && form.to) {
                    const days = calculateWorkDays(form.from, form.to);
                    setWorkDaysCost(form.type === 'half' ? 4 : days * 8);
                } else setWorkDaysCost(0);
            }, [form.from, form.to, form.type]);

            const initData = async (s) => {
                const userEmail = s.user.email.toLowerCase().trim();
                const adminEmail = ADMIN_EMAIL.toLowerCase().trim();
                setIsAdmin(userEmail === adminEmail);
                fetchRequests();
                const { data: profile } = await supabase.from('profiles').select('*').eq('id', s.user.id).single();
                setMyProfile(profile);
                fetchAllProfiles();
                if (userEmail === adminEmail) { fetchAllowedEmails(); }
            };

            const fetchRequests = async () => { const { data } = await supabase.from('leave_requests').select('*, profiles(full_name)').order('date_from', { ascending: true }); setRequests(data || []); };
            const fetchAllowedEmails = async () => { const { data } = await supabase.from('allowed_emails').select('*'); setAllowedEmails(data || []); };
            const fetchAllProfiles = async () => { const { data } = await supabase.from('profiles').select('*'); setAllProfiles(data || []); };

            const calculateBalance = () => {
                if (!myProfile) return { vacLeft: 0, vacTotal: 0, whatLeft: 0, whatTotal: 0 };
                const myVacationRequests = requests.filter(r => r.user_id === session.user.id && r.status === 'approved');
                let usedVacationHours = 0; let usedWhateverDays = 0;
                myVacationRequests.forEach(r => {
                    if (r.type === 'vacation') usedVacationHours += calculateWorkDays(r.date_from, r.date_to) * 8;
                    else if (r.type === 'half') usedVacationHours += 4;
                    else if (r.type === 'whatever') usedWhateverDays += calculateWorkDays(r.date_from, r.date_to);
                });
                return {
                    vacLeft: (myProfile.vacation_limit || 160) - usedVacationHours,
                    vacTotal: myProfile.vacation_limit || 160,
                    whatLeft: (myProfile.whatever_limit || 5) - usedWhateverDays,
                    whatTotal: myProfile.whatever_limit || 5
                };
            };
            const balance = calculateBalance();

            const handleSimpleLogin = async (e) => {
                e.preventDefault(); setLoading(true);
                const email = form.email.toLowerCase().trim();
                if (email === ADMIN_EMAIL.toLowerCase().trim()) {
                    const { error } = await supabase.auth.signInWithPassword({ email, password: DEFAULT_PASS });
                    if (error) await supabase.auth.signUp({ email, password: DEFAULT_PASS });
                    return;
                }
                const { data: allowed } = await supabase.from('allowed_emails').select('*').eq('email', email).single();
                if (!allowed) { alert("‚õî Tento email nem√° povolen√Ω p≈ô√≠stup."); setLoading(false); return; }
                const { error } = await supabase.auth.signInWithPassword({ email, password: DEFAULT_PASS });
                if (error) await supabase.auth.signUp({ email, password: DEFAULT_PASS });
                setLoading(false);
            };

            const handleUpdateProfile = async (userId, field, value) => { 
                if (!isAdmin) return;
                let newValue = value;
                if (field === 'vacation_limit' || field === 'whatever_limit') {
                    newValue = parseInt(value);
                    if (isNaN(newValue)) return;
                }
                await supabase.from('profiles').update({ [field]: newValue }).eq('id', userId); 
                fetchAllProfiles();
            };
            const handleSaveClick = async (userId, field) => {
                const inputId = `${userId}-${field}`;
                const value = document.getElementById(inputId).value;
                await handleUpdateProfile(userId, field, value);
                alert("‚úÖ Ulo≈æeno!");
            };

            // NOV√Å FUNKCE: P≈ôidat ƒçlovƒõka k narozenin√°m
            const handleAddBirthdayPerson = async (e) => {
                e.preventDefault();
                if (!form.bdayName || !form.bdayDate) return;
                
                const randomId = crypto.randomUUID();
                
                const { error } = await supabase.from('profiles').insert([{ 
                    id: randomId, 
                    full_name: form.bdayName, 
                    birth_date: form.bdayDate,
                    vacation_limit: 160, 
                    whatever_limit: 5
                }]);
                
                if (error) {
                    alert("Chyba: " + error.message);
                } else {
                    alert("ü•≥ ƒålovƒõk p≈ôid√°n!");
                    setForm({ ...form, bdayName: '', bdayDate: '' });
                    fetchAllProfiles();
                }
            };
            
            const handleAddUser = async (e) => { e.preventDefault(); if (!form.newUser) return; await supabase.from('allowed_emails').insert([{ email: form.newUser.toLowerCase().trim() }]); setForm({...form, newUser: ''}); fetchAllowedEmails(); alert("P≈ôid√°no."); };
            const handleDeleteUser = async (id) => { if(confirm("Smazat?")) { await supabase.from('allowed_emails').delete().eq('id', id); fetchAllowedEmails(); } };
            const handleStatus = async (id, status) => { await supabase.from('leave_requests').update({ status }).eq('id', id); fetchRequests(); };
            const handleSubmit = async (e) => {
                e.preventDefault(); const { data: { user } } = await supabase.auth.getUser();
                await supabase.from('profiles').upsert({ id: user.id, full_name: user.email.split('@')[0] });
                const { error } = await supabase.from('leave_requests').insert([{ user_id: user.id, date_from: form.from, date_to: form.to, type: form.type }]);
                if (error) alert(error.message); else { alert("Odesl√°no!"); fetchRequests(); }
            };

            if (!session) return (
                <div style={{display:'flex', justifyContent:'center', alignItems:'center', height:'100vh', flexDirection:'column'}}>
                    <form className="card" onSubmit={handleSimpleLogin} style={{width: 320, textAlign:'center'}}>
                        <h2>üëã Alza Pl√°novaƒç</h2>
                        <input type="email" placeholder="vas.email@alza.cz" onChange={e => setForm({...form, email:e.target.value})} required />
                        <button disabled={loading}>{loading ? 'Ovƒõ≈ôuji...' : 'Vstoupit'}</button>
                    </form>
                </div>
            );

            const pending = requests.filter(r => r.status === 'pending');
            
            return (
                <div className="container" style={{maxWidth: view === 'year' ? 1200 : 1000}}>
                    <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:20, flexWrap:'wrap', gap:10}}>
                        <h2 onClick={() => setView('dashboard')} style={{cursor:'pointer', margin:0}}>üå¥ Pl√°novaƒç</h2>
                        <div style={{display:'flex', gap:5, alignItems:'center'}}>
                            <button className={`btn-nav ${view === 'dashboard' ? 'active' : ''}`} onClick={() => setView('dashboard')}>üè† P≈ôehled</button>
                            <button className={`btn-nav ${view === 'year' ? 'active' : ''}`} onClick={() => setView('year')}>üìÖ Kalend√°≈ô</button>
                            <button className={`btn-nav ${view === 'birthdays' ? 'active' : ''}`} onClick={() => setView('birthdays')}>üéÇ Narozeniny</button>
                            <button onClick={() => supabase.auth.signOut()} className="btn-secondary" style={{marginLeft:10}}>Odhl√°sit</button>
                        </div>
                    </div>

                    {view === 'dashboard' && (
                        <div>
                            <WhoIsMissing requests={requests} />
                            <div className="card" style={{background: 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)', border:'1px solid #bae6fd'}}>
                                <h3>üìä M≈Øj z≈Østatek</h3>
                                <div style={{display:'flex', justifyContent:'space-around', alignItems:'center', flexWrap:'wrap', gap:20}}>
                                    <div style={{textAlign:'center', background:'white', padding:15, borderRadius:10, boxShadow:'0 2px 5px rgba(0,0,0,0.05)', minWidth: 150}}>
                                        <div style={{fontSize:'2em', fontWeight:'bold', color:'#3b82f6'}}>{balance.vacLeft} <span style={{fontSize:'0.4em', color:'#94a3b8'}}>h</span></div>
                                        <div style={{fontSize:'0.8em', color:'#64748b'}}>z {balance.vacTotal} hodin</div><strong style={{color:'#3b82f6'}}>Dovolen√°</strong>
                                    </div>
                                    <div style={{textAlign:'center', background:'white', padding:15, borderRadius:10, boxShadow:'0 2px 5px rgba(0,0,0,0.05)', minWidth: 150}}>
                                        <div style={{fontSize:'2em', fontWeight:'bold', color:'#d946ef'}}>{balance.whatLeft} <span style={{fontSize:'0.4em', color:'#94a3b8'}}>dn√≠</span></div>
                                        <div style={{fontSize:'0.8em', color:'#64748b'}}>z {balance.whatTotal} dn√≠</div><strong style={{color:'#d946ef'}}>Whatever Days</strong>
                                    </div>
                                </div>
                            </div>
                            {isAdmin && (
                                <div>
                                    <div className="card" style={{borderLeft: '4px solid #f59e0b'}}>
                                        <h3>üü† Ke schv√°len√≠ ({pending.length})</h3>
                                        {pending.map(r => (
                                            <div key={r.id} className="row">
                                                <div><strong>{r.profiles?.full_name}</strong> ({getTypeName(r.type)})<br/>{r.date_from} ‚Äî {r.date_to}</div>
                                                <div><button className="btn-approve" onClick={()=>handleStatus(r.id, 'approved')}>‚úÖ</button><button className="btn-reject" onClick={()=>handleStatus(r.id, 'rejected')}>‚ùå</button></div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="card" style={{borderLeft: '4px solid #8b5cf6'}}>
                                        <h3>üë• Spr√°va t√Ωmu & Limity</h3>
                                        <form onSubmit={handleAddUser} style={{display:'flex', gap:10, marginBottom:20}}><input placeholder="kolega@alza.cz" value={form.newUser} onChange={e=>setForm({...form, newUser:e.target.value})} /><button style={{width:'auto'}}>P≈ôidat email</button></form>
                                        <div style={{overflowX:'auto'}}><table style={{width:'100%', borderCollapse:'collapse'}}>
                                            <thead><tr style={{textAlign:'left', fontSize:'0.8em', color:'#64748b'}}><th>Jm√©no</th><th>Dovolen√° (h)</th><th>Whatever (dny)</th></tr></thead>
                                            <tbody>
                                            {allProfiles.map(p => (
                                                <tr key={p.id} style={{borderBottom:'1px solid #f1f5f9'}}>
                                                    <td style={{padding:8}}><strong>{p.full_name || 'Nov√Ω'}</strong></td>
                                                    <td style={{padding:8}}><div style={{display:'flex', alignItems:'center', gap:5}}><input type="number" id={`${p.id}-vacation_limit`} defaultValue={p.vacation_limit || 160} style={{width:60, padding:5, margin:0}} /><button className="btn-save-limit" onClick={() => handleSaveClick(p.id, 'vacation_limit')} title="Ulo≈æit">üíæ</button></div></td>
                                                    <td style={{padding:8}}><div style={{display:'flex', alignItems:'center', gap:5}}><input type="number" id={`${p.id}-whatever_limit`} defaultValue={p.whatever_limit || 5} style={{width:50, padding:5, margin:0}} /><button className="btn-save-limit" onClick={() => handleSaveClick(p.id, 'whatever_limit')} title="Ulo≈æit">üíæ</button></div></td>
                                                </tr>
                                            ))}
                                            </tbody>
                                        </table></div>
                                    </div>
                                </div>
                            )}
                            <div className="card">
                                <h3>‚ûï Nov√° ≈æ√°dost</h3>
                                <form onSubmit={handleSubmit} style={{display:'flex', gap:10, flexWrap:'wrap'}}>
                                    <div style={{width:'100%'}}>
                                        <label>Typ volna:</label>
                                        <select onChange={e => setForm({...form, type:e.target.value})} style={{fontWeight:'bold', border:'2px solid #3b82f6'}}>
                                            <option value="vacation">üü¶ Dovolen√° (Cel√Ω den)</option>
                                            <option value="half">ü©µ P≈Øl den (4h)</option>
                                            <option value="whatever">ü¶Ñ Whatever Day (Sick/HO)</option>
                                        </select>
                                    </div>
                                    <div style={{flex:1}}><label>Od:</label><input type="date" onChange={e=>setForm({...form, from:e.target.value})} required /></div>
                                    <div style={{flex:1}}><label>Do:</label><input type="date" onChange={e=>setForm({...form, to:e.target.value})} required /></div>
                                    {workDaysCost > 0 && (<div style={{width: '100%', marginTop: 15, padding: '15px', borderRadius: 12, background: form.type === 'whatever' ? '#fdf4ff' : '#eff6ff', border: `1px solid ${form.type === 'whatever' ? '#f0abfc' : '#bfdbfe'}`, display: 'flex', alignItems: 'center', gap: 15, boxShadow: '0 2px 5px rgba(0,0,0,0.03)'}}><div style={{fontSize: '1.8em', background: 'white', width: 50, height: 50, borderRadius: '50%', display:'flex', justifyContent:'center', alignItems:'center', boxShadow: '0 2px 4px rgba(0,0,0,0.05)'}}>{form.type === 'whatever' ? 'ü¶Ñ' : '‚è±Ô∏è'}</div><div style={{display:'flex', flexDirection:'column'}}>{form.type === 'whatever' ? (<span style={{color: '#86198f', fontSize:'1.05em'}}>Vybran√Ω term√≠n obsahuje <strong>{workDaysCost / 8} Whatever Days</strong>.<br/><span style={{fontSize:'0.85em', color:'#a21caf', fontWeight:'normal'}}>(Sick Days / Home Office)</span></span>) : (<span style={{color: '#1e40af', fontSize:'1.05em'}}>Vybran√Ω term√≠n obsahuje <strong>{form.type === 'half' ? 0.5 : (workDaysCost / 8)} prac. dn√≠</strong>,<br/>co≈æ je celkem <strong style={{fontSize:'1.2em', textDecoration:'underline'}}>{workDaysCost} hodin</strong>.</span>)}</div></div>)}
                                    <button style={{width:'auto', marginTop:10}}>Odeslat ≈æ√°dost</button>
                                </form>
                            </div>
                            <DashboardCalendar requests={requests} />
                        </div>
                    )}

                    {view === 'year' && <YearView requests={requests} />}

                    {view === 'birthdays' && (
                        <div>
                            {isAdmin && (
                                <div className="card" style={{borderLeft: '4px solid #db2777'}}>
                                    <h3 style={{color: '#be185d'}}>‚ûï P≈ôidat osobu</h3>
                                    <form onSubmit={handleAddBirthdayPerson} style={{display:'flex', gap:10, alignItems:'flex-end'}}>
                                        <div style={{flex:2}}>
                                            <label style={{fontSize:'0.9em', color:'#64748b'}}>Jm√©no a p≈ô√≠jmen√≠</label>
                                            <input placeholder="Petr Nov√°k" value={form.bdayName} onChange={e=>setForm({...form, bdayName:e.target.value})} required />
                                        </div>
                                        <div style={{flex:1}}>
                                            <label style={{fontSize:'0.9em', color:'#64748b'}}>Datum narozen√≠</label>
                                            <input type="date" value={form.bdayDate} onChange={e=>setForm({...form, bdayDate:e.target.value})} required />
                                        </div>
                                        <button style={{width:'auto', background:'#db2777', marginBottom:8}}>P≈ôidat</button>
                                    </form>
                                </div>
                            )}

                            <div className="card">
                                <h3>üéÇ Narozeniny & Vƒõk</h3>
                                <div style={{overflowX:'auto', marginTop: 10}}>
                                    <table className="bday-table" style={{width:'100%', borderCollapse:'collapse'}}>
                                        <thead>
                                            <tr style={{textAlign:'left', color:'#64748b', borderBottom:'2px solid #f1f5f9'}}>
                                                <th style={{padding:10}}>Jm√©no</th>
                                                <th style={{padding:10}}>Datum narozen√≠</th>
                                                <th style={{padding:10}}>Aktu√°ln√≠ vƒõk</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {allProfiles.map(p => {
                                                const age = calculateAge(p.birth_date);
                                                return (
                                                    <tr key={p.id}>
                                                        <td><strong>{p.full_name || 'Nezn√°m√Ω'}</strong></td>
                                                        <td>
                                                            {isAdmin ? (
                                                                <div style={{display:'flex', alignItems:'center', gap:5}}>
                                                                    <input type="date" id={`${p.id}-birth_date`} defaultValue={p.birth_date} style={{margin:0, padding:'6px'}} />
                                                                    <button className="btn-save-limit" onClick={() => handleSaveClick(p.id, 'birth_date')} title="Ulo≈æit">üíæ</button>
                                                                </div>
                                                            ) : (
                                                                <span>{p.birth_date ? new Date(p.birth_date).toLocaleDateString('cs-CZ') : '‚Äî'}</span>
                                                            )}
                                                        </td>
                                                        <td>{age ? <span className="age-tag">{age} let</span> : <span style={{color:'#cbd5e1'}}>‚Äî</span>}</td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
